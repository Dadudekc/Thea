# Architecture: Agent Debate Arena

**Task:** `FEATURE-DEBATE-ARENA-001`
**Status:** Design Phase

## 1. Overview

This document outlines the architecture for the Agent Debate Arena, a system designed to facilitate structured, multi-agent debates on specific topics or proposals within Dream.OS. The goal is to leverage diverse agent perspectives and LLM capabilities for exploration, analysis, and potentially consensus-building.

## 2. Core Concepts

*   **Debate:** A structured discussion focused on a specific `topic` or `proposal`, involving multiple agents assigned specific `roles` or `stances`.
*   **Debate Arena:** A dedicated environment (likely directory structure) where debate artifacts are stored.
*   **Debate Topic/Proposal:** The central subject matter under discussion.
*   **Persona/Stance:** Pre-defined roles or viewpoints assigned to participating agents to guide their arguments (e.g., "Proponent", "Skeptic", "Data Analyst", "Ethics Advisor").
*   **Debate Protocol:** Rules governing the structure and flow of the debate (e.g., opening statements, rebuttals, Q&A rounds, closing arguments, scoring/evaluation).
*   **Turns/Rounds:** The debate proceeds in defined steps or rounds.
*   **Arguments/Contributions:** Individual messages or statements made by agents during their turn, adhering to the persona/stance.
*   **Moderator (Optional):** An agent or system component responsible for enforcing the protocol, managing turns, scoring (if applicable), and summarizing.
*   **Logging/Transcript:** All contributions are logged chronologically to form a debate transcript.
*   **Evaluation/Scoring (Optional):** Mechanisms to assess the quality of arguments, adherence to stance, or overall debate outcome.

## 3. Proposed Architecture

1.  **Debate Arena Directory Structure (`runtime/agent_comms/debates/`)**
    *   Each subdirectory represents a single debate, named with a unique `debate_id`.
    *   Inside each debate directory:
        *   `manifest.json`: Metadata (topic, proposal_ref, participants, roles/stances, protocol, status, timestamps, moderator_id, scoring_info).
        *   `protocol.md`: Copy or reference to the specific debate protocol being used.
        *   `personas/`: Directory containing persona definition files.
            *   `<agent_id>_persona.md`: File describing the specific instructions, background, and stance assigned to an agent for this debate.
        *   `transcript/`: Directory containing argument/contribution files.
            *   `turn_<turn_number>_<agent_id>_<timestamp>.json`: JSON file containing the agent's contribution for that turn (argument text, references, etc.).
        *   `scores.json` (Optional): Stores evaluation scores if applicable.
        *   `summary.md` (Optional): Final summary generated by the moderator or system.

2.  **Persona Schema (`src/dreamos/core/comms/debate_schemas.py` - defines `Persona`)**
    *   Defines the structure for persona files (`<agent_id>_persona.json` - stored as JSON):
        *   `agent_id`: Target agent.
        *   `debate_id`: Associated debate.
        *   `role_name`: (e.g., "Proponent", "Skeptic").
        *   `stance_summary`: Brief description of the viewpoint to take.
        *   `instructions`: Detailed instructions on argumentation style, key points to make/refute, data sources to prioritize, constraints.
        *   `background_context`: Relevant snippets of information provided for the persona.

3.  **Argument Schema (`src/dreamos/core/comms/debate_schemas.py` - defines `Argument`)**
    *   Defines the structure for transcript files (`turn_...json`):
        *   `turn_number`: The sequential turn number.
        *   `agent_id`: Author agent.
        *   `timestamp_utc`: Time of submission.
        *   `argument_text`: The core statement/argument.
        *   `references`: List of sources, message IDs, or data points supporting the argument.
        *   `metadata`: (Optional) Confidence score, detected tone, etc.

4.  **Debate Protocol (V1 - Simple Turn-Based)**
    *   **Setup:** Moderator (or initiating agent) creates the debate structure, defines the topic, assigns personas, and sets the status to `open`.
    *   **Opening Statements:** Agents take turns providing initial arguments based on their persona (Round 1).
    *   **Rebuttal Rounds:** Agents take turns responding to previous arguments (Round 2+).
    *   **Closing Statements:** Agents provide final summaries.
    *   **Conclusion:** Moderator summarizes and sets status to `closed`.
    *   Turn order managed by Moderator or round-robin.
    *   Time limits per turn enforced by Moderator.

5.  **Agent Capabilities**
    *   `debate.initiate`: Creates a new debate arena, assigns personas. Input: `topic`, `participants_personas`, `protocol_id`. Output: `debate_id`.
    *   `debate.join`: Allows an assigned agent to acknowledge participation.
    *   `debate.get_persona`: Retrieves the specific persona instructions for the agent in a given debate.
    *   `debate.submit_argument`: Submits the agent's argument for the current turn. Input: `debate_id`, `turn_number`, `argument_data`. Output: Success/Fail.
    *   `debate.read_transcript`: Retrieves past arguments. Input: `debate_id`, `filter_options`. Output: List of arguments.
    *   `debate.get_info`: Retrieves the debate manifest.
    *   `(Moderator Only)` `debate.next_turn`: Signals the next agent/round.
    *   `(Moderator Only)` `debate.update_status`: Changes debate status.
    *   `(Moderator Only)` `debate.score_argument` (Optional).

6.  **Moderation**
    *   Can be a dedicated `ModeratorAgent` or assigned to one of the participating agents (if neutral role) or system.
    *   Enforces protocol, manages time, prompts agents, potentially scores/summarizes.

## 4. Implementation Details

*   **Persistence:** File-based, similar to Meeting System. Requires locking for shared files (`manifest.json`). Transcript files are unique per turn/agent, reducing write conflicts.
*   **LLM Interaction:** Agents will use LLMs to generate arguments based on their assigned persona and the debate history.
*   **State Management:** The `manifest.json` and turn progression need reliable updates.
*   **Agent Logic:** Agents need logic to understand their persona, read the transcript, formulate arguments, and adhere to the protocol.

## 5. Next Steps

1.  Define detailed Persona and Argument schemas.
2.  Implement core capabilities (`debate.initiate`, `debate.submit_argument`, `debate.read_transcript`, `debate.get_info`, `debate.get_persona`).
3.  Implement file/directory management.
4.  Develop a simple Moderator logic/agent.
5.  Develop a simple Debater agent logic.

## 6. Risks & Considerations

*   **Argument Quality:** LLM-generated arguments might be superficial or inconsistent without careful prompting and persona design.
*   **Echo Chambers:** Sticking too rigidly to personas might prevent genuine exploration.
*   **Complexity:** Managing turns, enforcing protocols, and potentially scoring can be complex.
*   **Scalability:** File system performance for very long transcripts. 